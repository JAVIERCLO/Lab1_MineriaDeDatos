---
title: "Laboratorio 1"
autor: "Javier Chávez, Genser Catalán, Samuel Mejía"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r paquetes}
library(ggplot2)
library(nortest)
```

```{r}
movies<- read.csv("../datos/movies_2026.csv")
colnames(movies)
```

### Ejercicio 1

```{r variables numéricas}
numericas <- c("budget","revenue","runtime","genresAmount","productionCoAmount","productionCountriesAmount","actorsAmount","castWomenAmount",
"castMenAmount","releaseYear", "popularity", "voteCount", "voteAvg") #Seleccionar solo numéricas
movies_num <- movies[, numericas]
colnames(movies_num)
```

```{r variables categóricas}
movies_cat <- movies[, !names(movies) %in% c(numericas, "id")] #Seleccionar solo categóricas
names(movies_cat)
```

El conjunto de datos está formado por '`r ncol(movies_num)` variables cuantitativas y '`r ncol(movies_cat)` variables cualitativas.

```{r Resumen de conjunto de datos numéricos}
summary(movies_num)
```

### Ejercicio 2

## Este ejercicio se realizo en una tabla en el documento de entrega del laboratorio.

### Ejercicio 3

```{r normalidad de variables cuantitativas}
hist(movies_num$budget)
boxplot(movies_num$budget)
lillie.test(movies_num$budget)
```

La variable "budget" no sigue una distribución normal.

```{r}
hist(movies_num$revenue)
boxplot(movies_num$revenue)
lillie.test(movies_num$revenue)
```

```{r}
hist(movies_num$runtime)
boxplot(movies_num$runtime)
lillie.test(movies_num$runtime)
```

```{r}
hist(movies_num$genresAmount)
boxplot(movies_num$genresAmount)
lillie.test(movies_num$genresAmount)
```

```{r}
hist(movies_num$productionCoAmount)
boxplot(movies_num$productionCoAmount)
lillie.test(movies_num$productionCoAmount)
```

```{r}
hist(movies_num$productionCountriesAmount)
boxplot(movies_num$productionCountriesAmount)
lillie.test(movies_num$productionCountriesAmount)
```

```{r}
hist(movies_num$actorsAmount)
boxplot(movies_num$actorsAmount)
lillie.test(movies_num$actorsAmount)
```

```{r}
hist(movies_num$castWomenAmount)
boxplot(movies_num$castWomenAmount)
lillie.test(movies_num$castWomenAmount)
```

```{r}
hist(movies_num$castMenAmount)
boxplot(movies_num$castMenAmount)
lillie.test(movies_num$castMenAmount)
```

```{r}
hist(movies_num$releaseYear)
boxplot(movies_num$releaseYear)
lillie.test(movies_num$releaseYear)
```

```{r}
hist(movies_num$popularity)
boxplot(movies_num$popularity)
lillie.test(movies_num$popularity)
```

```{r}
hist(movies_num$voteCount)
boxplot(movies_num$voteCount)
lillie.test(movies_num$voteCount)
```

```{r}
hist(movies_num$voteAvg)
boxplot(movies_num$voteAvg)
lillie.test(movies_num$voteAvg)
```

```{r}
table(movies$originalLanguage)
table(movies$video)
```

### Ejercicio 4.1

```{r}
top_budget <- movies[order(movies$budget, decreasing = TRUE), c("originalTitle", "budget")]
head(top_budget, 10)
```

### Ejercicio 4.2

```{r}
top_revenue <- movies[order(movies$revenue, decreasing = TRUE), c("originalTitle", "revenue")]
head(top_revenue, 10)
```

### Ejercicio 4.3

```{r}
mas_votos <- movies[which.max(movies$voteCount), c("originalTitle", "voteCount")]
print(mas_votos)
```

### Ejercicio 4.4

```{r}
peor_pelicula <- movies[which.min(movies$voteAvg), c("originalTitle", "voteAvg")]
print(peor_pelicula)
```

### Ejercicio 4.5

```{r}
#¿Cuántas películas se hicieron en cada año?
peliculas_por_anio <- table(movies$releaseYear)
df_peliculas_anio <- as.data.frame(peliculas_por_anio)
colnames(df_peliculas_anio) <- c("Anio", "Cantidad")
```

```{r}
#¿En qué año se hicieron más películas?
anio_mas_productivo <- df_peliculas_anio[which.max(df_peliculas_anio$Cantidad), ]
print(paste("El año con más películas fue:", anio_mas_productivo$Anio, "con", anio_mas_productivo$Cantidad, "películas."))
```

```{r}
#Grafica de barras
df_peliculas_anio$AnioNum <- as.numeric(as.character(df_peliculas_anio$Anio))
ggplot(df_peliculas_anio, aes(x = AnioNum, y = Cantidad)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad de Películas por Año",
       x = "Año de Lanzamiento",
       y = "Número de Películas") +
  theme_minimal()
```

# Ejericio 4.6

```{r}


movies$mainGenre <- sapply(strsplit(as.character(movies$genres), "\\|"), "[", 1)


# Género de las 20 más recientes 
movies$releaseDate <- as.Date(movies$releaseDate)
top_20_recientes <- head(movies[order(movies$releaseDate, decreasing = TRUE), ], 20)

print("--- Frecuencia de géneros en las 20 películas más recientes ---")
print(table(top_20_recientes$mainGenre))
# El que tenga el número más alto es la respuesta.


# Género predominante en todo el dataset y Gráfico 
conteo_generos <- sort(table(movies$mainGenre), decreasing = TRUE)
df_generos <- as.data.frame(conteo_generos)
colnames(df_generos) <- c("Genero", "Frecuencia")

# Gráfico de barras
library(ggplot2)
ggplot(df_generos, aes(x = reorder(Genero, -Frecuencia), y = Frecuencia)) +
  geom_bar(stat = "identity", fill = "darkcyan") +
  theme_minimal() +
  labs(title = "Géneros Predominantes en el Dataset", 
       x = "Género Principal", 
       y = "Cantidad de Películas") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rota los nombres para leerlos mejor


# Género de las películas más largas 
top_20_largas <- head(movies[order(movies$runtime, decreasing = TRUE), ], 20)

print("--- Géneros principales en las 20 películas más largas ---")
print(table(top_20_largas$mainGenre))
```

#Ejercicio 4.7
```{r}
movies$mainGenre <- sapply(strsplit(as.character(movies$genres), "\\|"), "[", 1)


ganancias_por_genero <- aggregate(revenue ~ mainGenre, data = movies, FUN = sum)


ganancias_ordenadas <- ganancias_por_genero[order(ganancias_por_genero$revenue, decreasing = TRUE), ]

print("--- Géneros con mayores ganancias totales ---")
print(head(ganancias_ordenadas, 10))


library(ggplot2)

ggplot(ganancias_ordenadas, aes(x = reorder(mainGenre, -revenue), y = revenue)) +
  geom_bar(stat = "identity", fill = "forestgreen") +
  scale_y_continuous(labels = scales::comma) + # Pone comas en los números grandes
  labs(title = "Ganancias Totales (Revenue) por Género Principal",
       x = "Género",
       y = "Dinero Recaudado ($)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Inclina los textos para leerlos bien
```

#Ejericio 4.8
```{r}
# ¿Influye la cantidad de actores en los ingresos? 
correlacion_actores_ingresos <- cor(movies$actorsAmount, movies$revenue, use = "complete.obs")

print(paste("Correlación entre cantidad de actores e ingresos:", round(correlacion_actores_ingresos, 3)))

library(ggplot2)
ggplot(movies, aes(x = actorsAmount, y = revenue)) +
  geom_point(alpha = 0.3, color = "darkblue") +
  geom_smooth(method = "lm", color = "red") + # Línea de tendencia
  labs(title = "¿Influye la cantidad de actores en los ingresos?",
       subtitle = paste("Correlación:", round(correlacion_actores_ingresos, 3)),
       x = "Cantidad de Actores",
       y = "Ingresos (Revenue)") +
  theme_minimal()


# ¿Se han hecho películas con más actores en los últimos años? 
actores_por_anio <- aggregate(actorsAmount ~ releaseYear, data = movies, FUN = mean)

ggplot(actores_por_anio, aes(x = releaseYear, y = actorsAmount)) +
  geom_line(color = "purple", size = 1) +
  geom_point() +
  labs(title = "Evolución de la Cantidad Promedio de Actores por Año",
       x = "Año de Lanzamiento",
       y = "Promedio de Actores por Película") +
  theme_minimal()
```

#Ejercicio 4.9
```{r}
# --- Análisis: Influencia de género en el reparto vs Popularidad e Ingresos ---

cor_mujeres_rev <- cor(movies$castWomenAmount, movies$revenue, use = "complete.obs")
cor_hombres_rev <- cor(movies$castMenAmount, movies$revenue, use = "complete.obs")

cor_mujeres_pop <- cor(movies$castWomenAmount, movies$popularity, use = "complete.obs")
cor_hombres_pop <- cor(movies$castMenAmount, movies$popularity, use = "complete.obs")


print("--- Correlación con INGRESOS (Revenue) ---")
print(paste("Mujeres:", round(cor_mujeres_rev, 3)))
print(paste("Hombres:", round(cor_hombres_rev, 3)))

print("--- Correlación con POPULARIDAD ---")
print(paste("Mujeres:", round(cor_mujeres_pop, 3)))
print(paste("Hombres:", round(cor_hombres_pop, 3)))



library(ggplot2)

# Gráfico: Mujeres vs Ingresos
g1 <- ggplot(movies, aes(x = castWomenAmount, y = revenue)) +
  geom_point(alpha = 0.3, color = "purple") +
  geom_smooth(method = "lm", color = "black") + # Línea de tendencia
  labs(title = "Impacto de Cantidad de Actrices en Ingresos",
       subtitle = paste("Correlación:", round(cor_mujeres_rev, 3)),
       x = "Cantidad de Mujeres en el Reparto",
       y = "Ingresos ($)") +
  theme_minimal()

# Gráfico: Hombres vs Ingresos
g2 <- ggplot(movies, aes(x = castMenAmount, y = revenue)) +
  geom_point(alpha = 0.3, color = "blue") +
  geom_smooth(method = "lm", color = "black") + # Línea de tendencia
  labs(title = "Impacto de Cantidad de Actores en Ingresos",
       subtitle = paste("Correlación:", round(cor_hombres_rev, 3)),
       x = "Cantidad de Hombres en el Reparto",
       y = "Ingresos ($)") +
  theme_minimal()

print(g1)
print(g2)
```

#Ejericio 4.10
```{r}
# --- Versión Mejorada: Filtrando películas con pocos votos ---


movies_filtradas <- subset(movies, voteCount > 100)


mejores_reales <- movies_filtradas[order(movies_filtradas$voteAvg, decreasing = TRUE), c("director", "originalTitle", "voteAvg")]

print(head(mejores_reales, 20))
```

### Ejercicio 4.11
```{r}
df_br <- movies[movies$budget > 0 & movies$revenue > 0, ]
summary(df_br$budget)
summary(df_br$revenue)
cor(df_br$budget, df_br$revenue)
plot(df_br$budget, df_br$revenue,
     main = "Presupuesto vs Ingresos",
     xlab = "Presupuesto",
     ylab = "Ingresos",
     pch = 16)
```

### Ejercicio 4.12
```{r}
movies$releaseMonth <- as.numeric(substr(movies$releaseDate, 6, 7))
mean(movies$revenue, na.rm = TRUE)
tapply(movies$revenue, movies$releaseMonth, mean, na.rm = TRUE)
boxplot(revenue ~ releaseMonth,
        data = movies,
        main = "Ingresos por mes de lanzamiento",
        xlab = "Mes",
        ylab = "Ingresos")
```

### Ejercicio4.13
```{r}
mean(movies$revenue, na.rm = TRUE)
tapply(movies$revenue, movies$releaseMonth, mean, na.rm = TRUE)
tapply(movies$id, movies$releaseMonth, length)
boxplot(revenue ~ releaseMonth,
        data = movies,
        main = "Distribución de ingresos por mes",
        xlab = "Mes",
        ylab = "Ingresos")
```

### Ejercicio 4.14
```{r}
df_votes <- movies[movies$voteAvg > 0 & movies$revenue > 0, ]
summary(df_votes$voteAvg)
summary(df_votes$revenue)
cor(df_votes$voteAvg, df_votes$revenue)
plot(df_votes$voteAvg, df_votes$revenue,
     main = "Calificación promedio vs Ingresos",
     xlab = "Calificación promedio",
     ylab = "Ingresos",
     pch = 16)

```

### Ejercicio 4.15
```{r}
tapply(movies$revenue, movies$video, mean, na.rm = TRUE)
boxplot(revenue ~ video,
        data = movies,
        main = "Ingresos según video promocional",
        xlab = "Tiene video",
        ylab = "Ingresos")
movies$hasHomepage <- ifelse(movies$homePage == "" | is.na(movies$homePage),"No", "Si")

tapply(movies$revenue, movies$hasHomepage, mean, na.rm = TRUE)
boxplot(revenue ~ hasHomepage,
        data = movies,
        main = "Ingresos según página oficial",
        xlab = "Página oficial",
        ylab = "Ingresos")

```

### Ejercicio 4.16
```{r}
df_cast <- movies[movies$actorsPopularity > 0 & movies$revenue > 0, ]
df_cast$actorsPopularity <- as.numeric(df_cast$actorsPopularity)
df_cast <- df_cast[!is.na(df_cast$actorsPopularity), ]

summary(df_cast$actorsPopularity)
summary(df_cast$revenue)
cor(df_cast$actorsPopularity, df_cast$revenue)
plot(df_cast$actorsPopularity, df_cast$revenue,
     main = "Popularidad del elenco vs Ingresos",
     xlab = "Popularidad del elenco",
     ylab = "Ingresos",
     pch = 16)

```

### Ejercicio 5 (extra)
¿La duración de las películas influye en los ingresos obtenidos?
```{r}
df_runtime <- movies[movies$runtime > 0 & movies$revenue > 0, ]
summary(df_runtime$runtime)
summary(df_runtime$revenue)
cor(df_runtime$runtime, df_runtime$revenue)
plot(df_runtime$runtime, df_runtime$revenue,
     main = "Duración vs Ingresos",
     xlab = "Duración (minutos)",
     ylab = "Ingresos",
     pch = 16)
```
¿Las películas con más géneros generan más ingresos?
```{r}
df_genres <- movies[movies$genresAmount > 0 & movies$revenue > 0, ]
summary(df_genres$genresAmount)
boxplot(revenue ~ genresAmount,
        data = df_genres,
        main = "Ingresos según cantidad de géneros",
        xlab = "Cantidad de géneros",
        ylab = "Ingresos")
```
¿La cantidad de compañías productoras influye en los ingresos?
```{r}
df_prod <- movies[movies$productionCoAmount > 0 & movies$revenue > 0, ]
summary(df_prod$productionCoAmount)
boxplot(revenue ~ productionCoAmount,
        data = df_prod,
        main = "Ingresos según compañías productoras",
        xlab = "Cantidad de compañías",
        ylab = "Ingresos")
```
¿El número de países de producción está relacionado con el éxito comercial?
```{r}
df_countries <- movies[movies$productionCountriesAmount > 0 & movies$revenue > 0, ]
summary(df_countries$productionCountriesAmount)
plot(df_countries$productionCountriesAmount, df_countries$revenue,
     main = "Países de producción vs Ingresos",
     xlab = "Cantidad de países de producción",
     ylab = "Ingresos",
     pch = 16)
```
¿Las películas más populares reciben más votos?
```{r}
df_countries <- movies[movies$productionCountriesAmount > 0 & movies$revenue > 0, ]
summary(df_countries$productionCountriesAmount)
plot(df_countries$productionCountriesAmount, df_countries$revenue,
     main = "Países de producción vs Ingresos",
     xlab = "Cantidad de países de producción",
     ylab = "Ingresos",
     pch = 16)
```

